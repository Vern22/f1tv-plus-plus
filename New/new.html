<html lang="en" data-react-helmet="lang">
<head>
<script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/bitmovinplayer.js"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/signalr@2.4.3/jquery.signalR.js"></script>
<script type="text/javascript">
   // src="https://cdn.bitmovin.com/player/web/8/bitmovinplayer.js"
function play()
{
    /*
    let m_sApiRoot = "https://livetiming.formula1.com/signalr";
    let connection = $.hubConnection(m_sApiRoot, { useDefaultPath: false });
    let hubProxy = connection.createHubProxy('Streaming');
    hubProxy.on('feed', function(userName, message) {
        console.log(userName + ' ' + message);
    });
    connection.logging = true;
    connection.start()
        .done(function()
        {
            alert("done");
            console.log('Now connected, connection ID=' + connection.id);
        })
        .fail(function()
        {
            alert("faile");
            console.log('Could not connect');

        });

            <meta http-equiv="Content-Security-Policy"
    content="default-src 'self' blob: data: *.bitmovin.com *.formula1.com *.jquery.com *.jsdelivr.net 'unsafe-eval' 'unsafe-inline';
    style-src  'self' *.bitmovin.com 'unsafe-eval' 'unsafe-inline';
    style-src-elem 'self' *.bitmovin.com 'unsafe-eval' 'unsafe-inline';
    font-src  'self' 'unsafe-eval' 'unsafe-inline';
    frame-ancestors 'self' *.formula1.com ">

    return;*/
    console.log("PLAYED");
        var playerConfig = {
            "key": "f142443f-c4c6-4b76-852f-bd1962c06732",
            "playback": {
                "muted": false,
                "autoplay": true
            }
        };

        //var videohtml = '<div id="my-new-player" style="position: fixed; top: 0%; left: 0; width: 100%; height: 100%;"></div>';
        //document.getElementsByTagName("body")[0].innerHTML = videohtml;*/
        var container = document.getElementById('my-new-player');
        var player = new bitmovin.player.Player(container, playerConfig);
        //https://f1tv.formula1.com/3.0/R/ENG/WEB_DASH/ALL/CONTENT/VIDEO/1000005149/F1_TV_Pro_Annual/14
        //https://f1tv.formula1.com/3.0/R/ENG/WEB_DASH/ALL/CONTENT/PLAY?channelId=1009&contentId=1000005149
        //CONTENT/PLAY?channelId=1009&contentId=1000005149
        var source = "https://ott-video-fer-cf.formula1.com/hls/F1_SUT_1663089173354_1663089733775/index.m3u8?kid=1042&exp=1663190856&ttl=1440&token=bRb1T8gNThWcAVrZfcADYh57EHylijtm7E20WWCYq4Q_"
        //"https://ott-video-fer-cf.formula1.com/c8059270529e63e492b34317933c3dca/out/v1/4830ab3307b24ce2b603bef457c1f73e/33957307c5b848a6bea693bb400a7166/e4d49ef8077f4032a097e2b0c8a962bb/index.m3u8?kid=1042&exp=1656181124&ttl=1440&token=IBf8CxeW~5m4D1Hz7xbqgygDg-nDdfZZYNfYrlroz~E_"
		//outputURL;// "https://ott-video-fer-cf.formula1.com/hls/F1_SUT_1655674572719_1655683012504/index.m3u8?kid=1042&exp=1655829307&ttl=1440&token=KYSWhlnGOMO1siIPwsF~k~YPUlTBV8c2glWngjNl6Ho_";
        //;//"https://f1tv.formula1.com/2.0/R/ENG/WEB_HLS/ALL/CONTENT/PLAY?contentId=1000005149";

        var sourceConfig = {
            "title": "Default Demo Source Config",
            "description": "Select another example in \"Step 4 - Load a Source\" to test it here",
            "hls": source,//"https://bitmovin-a.akamaihd.net/content/MI201109210084_1/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8",
            //"smooth": "https://test.playready.microsoft.com/smoothstreaming/SSWSS720H264/SuperSpeedway_720.ism/manifest",
            //"progressive": "https://bitmovin-a.akamaihd.net/content/MI201109210084_1/MI201109210084_mpeg-4_hd_high_1080p25_10mbits.mp4",
            options: {
                manifestWithCredentials: true,
                withCredentials: true
            }
        }
        player.load(sourceConfig);
{
    var container = document.getElementById('my-new-player1');
        var player = new bitmovin.player.Player(container, playerConfig);
        //https://f1tv.formula1.com/3.0/R/ENG/WEB_DASH/ALL/CONTENT/VIDEO/1000005149/F1_TV_Pro_Annual/14
        //https://f1tv.formula1.com/3.0/R/ENG/WEB_DASH/ALL/CONTENT/PLAY?channelId=1009&contentId=1000005149
        //CONTENT/PLAY?channelId=1009&contentId=1000005149
        //var source ="https://ott-video-fer-cf.formula1.com/c8059270529e63e492b34317933c3dca/out/v1/4830ab3307b24ce2b603bef457c1f73e/33957307c5b848a6bea693bb400a7166/e4d49ef8077f4032a097e2b0c8a962bb/index.m3u8?kid=1042&exp=1655974674&ttl=1440&token=AygzkFys-jnduz0DLzQ7Lljrs2C4C~AZIXtGP~dmoc8_"
		//outputURL;// "https://ott-video-fer-cf.formula1.com/hls/F1_SUT_1655674572719_1655683012504/index.m3u8?kid=1042&exp=1655829307&ttl=1440&token=KYSWhlnGOMO1siIPwsF~k~YPUlTBV8c2glWngjNl6Ho_";
        //;//"https://f1tv.formula1.com/2.0/R/ENG/WEB_HLS/ALL/CONTENT/PLAY?contentId=1000005149";

        var sourceConfig = {
            "title": "Default Demo Source Config",
            "description": "Select another example in \"Step 4 - Load a Source\" to test it here",
            "hls": source,//"https://bitmovin-a.akamaihd.net/content/MI201109210084_1/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8",
            //"smooth": "https://test.playready.microsoft.com/smoothstreaming/SSWSS720H264/SuperSpeedway_720.ism/manifest",
            //"progressive": "https://bitmovin-a.akamaihd.net/content/MI201109210084_1/MI201109210084_mpeg-4_hd_high_1080p25_10mbits.mp4",
            options: {
                manifestWithCredentials: true,
                withCredentials: true
            }
        }
        player.load(sourceConfig);

}

{
    var container = document.getElementById('my-new-player2');
        var player = new bitmovin.player.Player(container, playerConfig);
        //https://f1tv.formula1.com/3.0/R/ENG/WEB_DASH/ALL/CONTENT/VIDEO/1000005149/F1_TV_Pro_Annual/14
        //https://f1tv.formula1.com/3.0/R/ENG/WEB_DASH/ALL/CONTENT/PLAY?channelId=1009&contentId=1000005149
        //CONTENT/PLAY?channelId=1009&contentId=1000005149
        //var source ="https://ott-video-fer-cf.formula1.com/c8059270529e63e492b34317933c3dca/out/v1/4830ab3307b24ce2b603bef457c1f73e/33957307c5b848a6bea693bb400a7166/e4d49ef8077f4032a097e2b0c8a962bb/index.m3u8?kid=1042&exp=1655974674&ttl=1440&token=AygzkFys-jnduz0DLzQ7Lljrs2C4C~AZIXtGP~dmoc8_"
		//outputURL;// "https://ott-video-fer-cf.formula1.com/hls/F1_SUT_1655674572719_1655683012504/index.m3u8?kid=1042&exp=1655829307&ttl=1440&token=KYSWhlnGOMO1siIPwsF~k~YPUlTBV8c2glWngjNl6Ho_";
        //;//"https://f1tv.formula1.com/2.0/R/ENG/WEB_HLS/ALL/CONTENT/PLAY?contentId=1000005149";

        var sourceConfig = {
            "title": "Default Demo Source Config",
            "description": "Select another example in \"Step 4 - Load a Source\" to test it here",
            "hls": source,//"https://bitmovin-a.akamaihd.net/content/MI201109210084_1/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8",
            //"smooth": "https://test.playready.microsoft.com/smoothstreaming/SSWSS720H264/SuperSpeedway_720.ism/manifest",
            //"progressive": "https://bitmovin-a.akamaihd.net/content/MI201109210084_1/MI201109210084_mpeg-4_hd_high_1080p25_10mbits.mp4",
            options: {
                manifestWithCredentials: true,
                withCredentials: true
            }
        }
        player.load(sourceConfig);

        var win = window.open("https://f1tv.formula1.com/");

        win.addEventListener("load", () =>{
            var cookie = getCookieFromDoc("login-session", win.document);
            var cookie2 = JSON.parse(decodeURIComponent(cookie));
            sF1SubscriptionToken = cookie2.data.subscriptionToken;
            console.log("SUBSCRIPTION: " + sF1SubscriptionToken);
        });
}


//$('.bmpui-ui-watermark').toggle();
		return;
		}
    'use strict';
    
    function getCookie(cname) {
        let name = cname + "=";
        let decodedCookie = decodeURIComponent(document.cookie);
        let ca = decodedCookie.split(';');
        for(let i = 0; i <ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }

    function getCookieFromDoc(cname, p_document) {
        let name = cname + "=";
        let decodedCookie = decodeURIComponent(p_document.cookie);
        let ca = decodedCookie.split(';');
        for(let i = 0; i <ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }

    var sF1SubscriptionToken = "";

    async function onAvailableStreams(response)
    {
        //get the first stream
        var playbackURL = "https://f1tv.formula1.com/2.0/R/ENG/WEB_HLS/ALL/" + response.resultObj.containers[0].metadata.additionalStreams[0].playbackUrl;

        var response = await fetch(playbackURL, {
            method: 'GET',
            headers: {
                'ascendontoken': sF1SubscriptionToken,
            }
        })

        if(response.status !== 200)
        {
            console.log("playbackURL: resposne status not 200: " +  response.statusText);
            return;
        }

        var resp = await response.json();
        var outputURL = resp.resultObj.url;

        //playback token.
        var response = await fetch(outputURL, {
            method: 'HEAD'
        });

        if(response.status !== 200)
        {
            console.log("outputURL: resposne status not 200: " +  response.statusText);
            return;
        }
        //resp = await response.json();
        console.log(...response.headers)
        var cookie = decodeURIComponent(response.headers.get("cookie"));
        console.log("Next Cookie: " + 	cookie);



    }

    function getF1StreamLinks()
    {
        //window.location.href = "https://f1tv.formula1.com/";
        //content ID is between detail/ and the next /
        var contentID = 1000005148;
        /*var str = "detail/";
        var id1 = window.location.href.indexOf(str);
        id1+= str.length;
        var id2 = window.location.href.indexOf("/", id1);
        contentID = window.location.href.slice(id1, id2);

        var cookie = getCookie("login-session");
        var cookie2 = JSON.parse(decodeURIComponent(cookie));
        sF1SubscriptionToken = cookie2.data.subscriptionToken;*/
sF1SubscriptionToken="eyJraWQiOiIxIiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJFeHRlcm5hbEF1dGhvcml6YXRpb25zQ29udGV4dERhdGEiOiJHQlIiLCJTdWJzY3JpcHRpb25TdGF0dXMiOiJhY3RpdmUiLCJTdWJzY3JpYmVySWQiOiIxODE3Njk3MTEiLCJGaXJzdE5hbWUiOiJBZHJpYW4iLCJMYXN0TmFtZSI6IlNhbGUiLCJleHAiOjE2NTU4ODkyMjUsIlNlc3Npb25JZCI6ImV5SmhiR2NpT2lKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXhMekEwTDNodGJHUnphV2N0Ylc5eVpTTm9iV0ZqTFhOb1lUSTFOaUlzSW5SNWNDSTZJa3BYVkNKOS5leUppZFNJNklqRXdNREV4SWl3aWMya2lPaUkyTUdFNVlXUTROQzFsT1ROa0xUUTRNR1l0T0RCa05pMWhaak0zTkRrMFpqSmxNaklpTENKb2RIUndPaTh2YzJOb1pXMWhjeTU0Yld4emIyRndMbTl5Wnk5M2N5OHlNREExTHpBMUwybGtaVzUwYVhSNUwyTnNZV2x0Y3k5dVlXMWxhV1JsYm5ScFptbGxjaUk2SWpFNE1UYzJPVGN4TVNJc0ltbGtJam9pT0RNek1qRTFNMlF0TUdVMVppMDBZbUU0TFRsaE1qUXRNVEpqTXpnMllUVm1Zamd3SWl3aWRDSTZJakVpTENKc0lqb2laVzR0UjBJaUxDSmtZeUk2SWpNMk5EUWlMQ0poWldRaU9pSXlNREl5TFRBM0xUQXlWREE1T2pFek9qUTBMamsyT0ZvaUxDSmtkQ0k2SWpFaUxDSmxaQ0k2SWpJd01qSXRNRGN0TVRoVU1EazZNVE02TkRRdU9UWTRXaUlzSW1ObFpDSTZJakl3TWpJdE1EWXRNVGxVTURrNk1UTTZORFF1T1RZNFdpSXNJbWx3SWpvaU1qRXlMak13TGpNM0xqY3lJaXdpWXlJNklrRk5VMVJGVWtSQlRTSXNJbk4wSWpvaVRrZ2lMQ0p3WXlJNklqRXhNREVpTENKamJ5STZJazVNUkNJc0lteGhkQ0k2SWpVeUxqTXdPU0lzSW14dmJtY2lPaUkwTGprME1ESWlMQ0p1WW1ZaU9qRTJOVFUxTkRNMk1qUXNJbVY0Y0NJNk1UWTFPREV6TlRZeU5Dd2lhWE56SWpvaVlYTmpaVzVrYjI0dWRIWWlMQ0poZFdRaU9pSmhjMk5sYm1SdmJpNTBkaUo5LlpNYXc0bk1DdUoxNFJpOUN6eFQzc1l6SmxmRVpnMExNa1VKZjJaa05lbTgiLCJpYXQiOjE2NTU1NDM2MjUsIlN1YnNjcmliZWRQcm9kdWN0IjoiRjEgVFYgUHJvIE1vbnRobHkiLCJqdGkiOiIzM2U3NDhlZi04ZDhkLTQzOGQtYjQyOC02MGJmYTA3YjE4ZjAifQ.d-N6uUQM5wKJNvUcLRBXQQWcPUcuw4fKSOCc-CxldPWvuXm1J4CiXt--_mohlK0yfPuauDSZLYjNz030QPk0onNOOxVFJ6oO6A8Ku1chC0Z_zZKQoG0OUFeGt2CiZ6UgumPXV94cW2o4dytDr5Hq88KYsFMX5yabBMcIaz6GBPKBOYcvaLIfukozLg-QIgJP2nh_dcThcbdRD-bT_-Wv4geCEHvlQPieihu85cNvJQKC6QHJIiKA0RioROzH1TjKlJfgfv9D1ip1_a6uM6bH3REOk2G0QgNBdlTgS7ttRlg-JX58-RBrmhhQ_-kt3J8wTxIWHqPRVXK7ZaLPQRbMIg"

        var streamListURL = "https://f1tv.formula1.com/3.0/R/ENG/WEB_DASH/ALL/CONTENT/VIDEO/" + contentID + "/F1_TV_Pro_Annual/14"

        fetch(streamListURL,            
		{headers: {
                'origin': "https://f1tv.formula1.com/",
            }})
            .then(response => {
            if(response.status !== 200)
            {
                console.log("streamListURL: resposne status not 200: " +  response.statusText);
                return;
            }

            response.json().then(response => {
                // handle the response
                onAvailableStreams(response);
            });
        })
            .catch(error => {
            // handle the error
        });
    }

    //window.addEventListener("load", play);

    //play();
</script>
<meta charset="UTF-8">
<title>F1TV | 2022 Canadian Grand Prix</title>
</head><body>
    <video src="http://127.0.0.1:60000/file.avi" controls></video>

<div id="my-new-player" style="position: fixed; top: 50%; left: 50%; width: 33vw; height: 100vh;"></div>
<div id="my-new-player1" style="position: fixed; top: 50%; left: 33%; width: 33vw; height: 100vh;"></div>
<div id="my-new-player2" style="position: fixed; top: 50%; left: 66%; width: 33vw; height: 100vh;"></div>
</body>
</html>